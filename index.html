<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SSTLaw ID card MRZ verification</title>
  <meta name="description" content="Upload EEA/CH/UK ID front/back, extract MRZ (optional), verify, and send to SSTLaw." />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;background:#f7f8fb;color:#0b1220}
    header{background:#0a1a3a;color:#fff;padding:20px}
    header h1{margin:0;font-size:22px}
    main{max-width:900px;margin:32px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:18px 18px 10px;margin-bottom:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    label{font-weight:600;display:block;margin:8px 0 6px}
    input[type="file"],input[type="text"],textarea{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px}
    textarea{min-height:90px}
    .btn{appearance:none;border:0;border-radius:12px;background:#1e3a8a;color:#fff;padding:10px 16px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#64748b}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .link{appearance:none;border:0;background:transparent;color:#1e3a8a;text-decoration:underline;cursor:pointer;padding:0;font-weight:600}
    .note{color:#475569;font-size:13px;margin-top:6px}
    .status{margin-top:10px;font-size:14px}
    .ok{color:#0b8a41}.err{color:#b42318}.info{color:#1e40af}
    .preview{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .preview img{max-height:120px;border:1px solid #e5e7eb;border-radius:10px}
    footer{font-size:13px;color:#475569;margin:32px auto;max-width:900px;padding:0 16px}
    code{background:#f3f4f6;padding:0 4px;border-radius:6px}
    .steps{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .steps .btn span.step{background:#0b1220;display:inline-block;margin-right:8px;padding:2px 8px;border-radius:999px;font-weight:800}
    /* Progress bars */
    .prog-wrap{margin-top:10px}
    .prog{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .prog > .bar{height:100%;width:0;background:#1e3a8a;transition:width .2s ease}
    .prog-note{font-size:12px;color:#475569;margin-top:6px}
    .indet .bar{width:30%;animation:indet 1.2s infinite}
    @keyframes indet { 0% {margin-left:-30%} 50%{margin-left:50%} 100%{margin-left:100%} }

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{background:#fff;max-width:720px;width:95%;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
    .modal header{background:#0a1a3a;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
    .modal header h2{margin:0;font-size:18px}
    .modal .close{background:none;border:none;color:#fff;font-size:20px;cursor:pointer}
    .modal .content{padding:16px}
    .modal img{max-width:100%;border:1px solid #ddd;border-radius:8px;margin:10px 0}
  </style>

  <!-- Tesseract.js (browser OCR) -->
  <script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
</head>
<body>
  <header><h1>SSTLaw ID card MRZ verification</h1></header>

  <main>
    <div class="card">
      <p class="note"><strong>Currently, only ID cards issued by a member State of the European Economic Area, Switzerland, and the United Kingdom are accepted.</strong> Support for international passports will be implemented soon. Thank you for your understanding.</p>

      <p><strong>Accepted file formats:</strong> JPG, JPEG, PNG, PDF (max ~10&nbsp;MB total). Upload the <em>front</em> and <em>back</em> of the ID card.</p>
      <div class="row">
        <div>
          <label for="frontFile">Front side</label>
          <input id="frontFile" type="file" accept="image/*,application/pdf" />
          <div id="frontPreview" class="preview"></div>
        </div>
        <div>
          <label for="backFile">Back side (MRZ)</label>
          <input id="backFile" type="file" accept="image/*,application/pdf" />
          <div id="backPreview" class="preview"></div>
        </div>
      </div>

      <p class="note">Need help? <button class="link" id="whatIsMrzBtn">What is MRZ text?</button></p>

      <label for="mrzText">MRZ text</label>
      <textarea id="mrzText" placeholder="Paste the MRZ here if needed (3 lines for ID cards)."></textarea>

      <div class="steps">
        <button id="extractBtn" class="btn secondary" type="button">
          <span class="step">1</span>Extract MRZ from images
        </button>
        <button id="parseMrzBtn" class="btn secondary" type="button">
          <span class="step">2</span>Verify MRZ
        </button>
        <button id="sendBtn" class="btn" type="button">
          <span class="step">3</span>Send to office
        </button>
      </div>

      <!-- OCR progress -->
      <div id="ocrProgWrap" class="prog-wrap" style="display:none">
        <div class="prog"><div id="ocrBar" class="bar"></div></div>
        <div id="ocrNote" class="prog-note">OCR starting…</div>
      </div>

      <!-- Send progress -->
      <div id="sendProgWrap" class="prog-wrap" style="display:none">
        <div class="prog indet"><div id="sendBar" class="bar"></div></div>
        <div id="sendNote" class="prog-note">Sending to SSTLaw…</div>
      </div>

      <div id="status" class="status info"></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Extracted fields</h3>
      <div class="row-3">
        <div><label>Surname</label><input id="outSurname" type="text" readonly /></div>
        <div><label>Given names</label><input id="outGiven" type="text" readonly /></div>
        <div><label>Issuing country</label><input id="outIssuing" type="text" readonly /></div>
        <div><label>Nationality</label><input id="outNat" type="text" readonly /></div>
        <div><label>Birth date</label><input id="outBirth" type="text" readonly /></div>
        <div><label>Expiry date</label><input id="outExpiry" type="text" readonly /></div>
        <div><label>Document no.</label><input id="outDoc" type="text" readonly /></div>
      </div>
    </div>
  </main>

  <footer>
    <strong>GDPR &amp; Privacy (brief):</strong> Your uploads are used solely to extract MRZ data and email it to SSTLaw (<code>llenert@sstlaw.lu</code>).
    Files and derived data are not stored by the website; the email is sent via a secure provider (SendGrid). By using this form, you confirm you have the right to share the images. For data rights (access, rectification, erasure), contact <code>info@sstlaw.lu</code>.
  </footer>

  <!-- MRZ modal -->
  <div id="mrzModal" class="modal-backdrop">
    <div class="modal">
      <header>
        <h2>What is MRZ text?</h2>
        <button class="close" id="closeMrzModal">&times;</button>
      </header>
      <div class="content">
        <p>The <strong>Machine Readable Zone (MRZ)</strong> is the block of two or three lines at the bottom of ID documents, printed in OCR-B font with characters <code>A–Z</code>, digits <code>0–9</code> and the filler symbol <code>&lt;</code>.</p>
        <img src="pictures/mrz.jpg" alt="MRZ example on ID card">
        <p>In the European Union, the MRZ on standardised identity cards (TD-1 format) always consists of <strong>3 lines of 30 characters</strong>. It encodes the document type, issuing state, document number, dates of birth and expiry, and the holder’s names in a structured way, so that it can be automatically read and validated by border control and identity verification systems.</p>
        <p><a href="https://www.consilium.europa.eu/prado/en/prado-glossary/prado-glossary.pdf#page=88" target="_blank">For more information, click here</a></p>
      </div>
    </div>
  </div>

  <script>
    // Modal logic
    const mrzModal=document.getElementById('mrzModal');
    document.getElementById('whatIsMrzBtn').onclick=()=>{mrzModal.style.display='flex';};
    document.getElementById('closeMrzModal').onclick=()=>{mrzModal.style.display='none';};
    mrzModal.onclick=(e)=>{if(e.target===mrzModal)mrzModal.style.display='none';};

    // Example modification in Verify MRZ error handler
    function showMrzError(message){
      document.getElementById('status').textContent=
        "The image recognition software seems to have scrambled the MRZ text. " +
        "We apologize for any inconvenience. " +
        "Please manually insert and/or correct the entire MRZ text (3 lines) exactly as it appears on your ID card, " +
        "and then click “Verify MRZ” again. ("+message+")";
      document.getElementById('status').className='status err';
    }
  </script>
</body>
</html>